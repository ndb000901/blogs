# 安全点（Safepoint）


**安全点（Safepoint）** 是JVM执行过程中某些特殊的位置，只有在这些位置，JVM才能安全地暂停所有Java线程，以执行GC、线程堆栈扫描、类加载等需要全局一致性的操作。

在JVM中，线程执行时不能随时被暂停，因为它们可能处于修改对象、更新栈帧等关键状态，直接打断可能导致内存不一致或程序崩溃。因此，JVM会在某些特定的**安全点**暂停线程，使它们处于可以安全执行GC或其他操作的状态。

---

## **安全点的作用**
主要用于：
1. **GC（垃圾回收）**  
   - 在GC时，所有Java线程必须暂停，以确保GC能准确地标记、整理或清理对象。
2. **类加载和重定义**  
   - 运行时动态加载类、修改类结构时，JVM需要确保所有线程都处于可控状态。
3. **偏向锁撤销**  
   - 偏向锁需要撤销时，JVM也会在安全点暂停线程以进行处理。
4. **栈扫描（如SafePoint Polling）**  
   - 执行逃逸分析、栈上分配、JIT优化时，可能需要检查线程栈信息。

---

## **安全点的触发机制**
JVM不会随时让线程进入安全点，而是通过 **轮询机制（Polling）** 触发：
1. **JVM会在热点代码（如方法调用、循环回边、异常处理）插入安全点**。
2. **当GC或其他需要暂停所有线程的事件发生时，JVM会通知所有Java线程进入安全点**。
3. **线程必须等到执行到安全点时，才会响应暂停请求**。
