# EC å¯†é’¥ç®¡ç†

## 1. `openssl ecparam` å‘½ä»¤

openssl ecparam å‘½ä»¤ç”¨äº ç®¡ç†æ¤­åœ†æ›²çº¿å‚æ•°ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

- ç”Ÿæˆæ¤­åœ†æ›²çº¿å‚æ•°ï¼ˆEC å‚æ•°ï¼‰
- æŸ¥çœ‹æ¤­åœ†æ›²çº¿å‚æ•°ä¿¡æ¯
- ç”Ÿæˆ EC ç§é’¥
- ç”Ÿæˆ EC è¯ä¹¦è¯·æ±‚ï¼ˆCSRï¼‰

### 1.1 å‚æ•°è¯¦è§£

| **ç±»åˆ«**        | **é€‰é¡¹**             | **è¯´æ˜** |
|---------------|--------------------|------|
| **é€šç”¨é€‰é¡¹** | `-help`            | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
|  | `-list_curves`     | åˆ—å‡º OpenSSL æ”¯æŒçš„æ‰€æœ‰æ¤­åœ†æ›²çº¿ |
|  | `-engine val`      | æŒ‡å®šåŠ å¯†å¼•æ“ï¼Œå¯èƒ½æ˜¯ç¡¬ä»¶è®¾å¤‡ |
| **è¾“å…¥é€‰é¡¹** | `-in infile`       | æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼ˆé»˜è®¤ stdinï¼‰ |
|  | `-inform PEM\|DER` | æŒ‡å®šè¾“å…¥æ ¼å¼ï¼ˆPEM æˆ– DERï¼Œé»˜è®¤ä¸º PEMï¼‰ |
| **è¾“å‡ºé€‰é¡¹** | `-out outfile`     | æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼ˆé»˜è®¤ stdoutï¼‰ |
|  | `-outform PEM\|DER` | æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼ˆPEM æˆ– DERï¼Œé»˜è®¤ä¸º PEMï¼‰ |
|  | `-text`            | ä»¥æ–‡æœ¬æ ¼å¼æ‰“å° EC å‚æ•° |
|  | `-noout`           | ä¸è¾“å‡º EC å‚æ•°ï¼ˆé€šå¸¸ä¸ `-text` ç»„åˆä½¿ç”¨ï¼‰ |
|  | `-param_enc val`   | æŒ‡å®š EC å‚æ•°çš„ç¼–ç æ–¹å¼ï¼š`explicit`ï¼ˆæ˜¾å¼å­˜å‚¨ï¼‰æˆ– `named_curve`ï¼ˆå­˜å‚¨æ›²çº¿åç§°ï¼Œé»˜è®¤ï¼‰ |
| **å‚æ•°ç®¡ç†** | `-check`           | éªŒè¯ EC å‚æ•°æ˜¯å¦æœ‰æ•ˆ |
|  | `-check_named`     | æ£€æŸ¥å‘½åçš„ EC æ›²çº¿å‚æ•°æ˜¯å¦è¢«ä¿®æ”¹ |
|  | `-no_seed`         | å½“é€‰æ‹© `explicit` å‚æ•°æ—¶ï¼Œä¸ä½¿ç”¨ç§å­ |
|  | `-name val`        | ä½¿ç”¨æŒ‡å®šçš„æ¤­åœ†æ›²çº¿ï¼ˆçŸ­åç§°ï¼‰ |
|  | `-conv_form val`   | æŒ‡å®šç‚¹è½¬æ¢æ ¼å¼ï¼ˆ`compressed`ã€`uncompressed` æˆ– `hybrid`ï¼‰ |
| **éšæœºæ•°é€‰é¡¹** | `-rand val`        | è½½å…¥æŒ‡å®šçš„éšæœºæ•°æ–‡ä»¶ |
|  | `-writerand outfile` | å°†éšæœºæ•°æ®å†™å…¥æŒ‡å®šæ–‡ä»¶ |
| **æä¾›è€…é€‰é¡¹** | `-provider-path val` | æŒ‡å®šåŠ å¯†æä¾›è€…çš„è·¯å¾„ |
|  | `-provider val`    | åŠ è½½æŒ‡å®šçš„åŠ å¯†æä¾›è€…ï¼ˆå¯å¤šæ¬¡æŒ‡å®šï¼‰ |
|  | `-propquery val`   | åœ¨è·å–ç®—æ³•æ—¶ä½¿ç”¨å±æ€§æŸ¥è¯¢ |

---

### 1.2 æ¤­åœ†æ›²çº¿å‘½åè§„åˆ™

å¸¸è§çš„æ¤­åœ†æ›²çº¿å‘½åä¸€èˆ¬åŒ…æ‹¬ **ä¸‰éƒ¨åˆ†**ï¼š
1. **ç±»å‹ï¼ˆæ ‡å‡†ç»„ç»‡/æ•°å­¦æ€§è´¨ï¼‰**
2. **å¯†é’¥é•¿åº¦ï¼ˆæ¯”ç‰¹ä½ï¼‰**
3. **å¯é€‰çš„åç¼€ï¼ˆç‰¹å®šç‰¹æ€§ï¼‰**

---

#### NIST æ ‡å‡†æ›²çº¿ï¼ˆP ç³»åˆ—ï¼‰
- **æ ¼å¼**ï¼š`secpXXXr1` æˆ– `primeXXXv1`
- **æ¥æº**ï¼šç”±ç¾å›½å›½å®¶æ ‡å‡†ä¸æŠ€æœ¯ç ”ç©¶é™¢ï¼ˆNISTï¼‰å®šä¹‰ï¼Œç¬¦åˆ **FIPS 186-4** æ ‡å‡†
- **ç‰¹ç‚¹**ï¼š
  - **`secp`**ï¼šè¡¨ç¤º "SEC Prime"ï¼ˆç”¨äºå¯†ç å­¦çš„ç´ æ•°æ›²çº¿ï¼‰
  - **`prime`**ï¼šè¡¨ç¤ºæ›²çº¿çš„åŸºåŸŸæ˜¯ç´ æ•°åŸŸï¼ˆğ”½_pï¼‰
  - **`XXX`**ï¼šæ›²çº¿çš„ä½æ•°ï¼ˆå¯†é’¥å¤§å°ï¼‰ï¼Œå¦‚ `256`ã€`384`ã€`521`
  - **`r1`/`v1`**ï¼šè¡¨ç¤ºè¯¥ç‰ˆæœ¬çš„æ›²çº¿ï¼ˆé€šå¸¸ `r1` è¡¨ç¤ºç¬¬ä¸€ç‰ˆï¼‰


| **æ›²çº¿åç§°**  | **ä½æ•°** | **ç”¨é€”** |
|------------|------|------|
| `secp256r1` | 256  | TLSã€æ•°å­—ç­¾åã€å¯†é’¥äº¤æ¢ |
| `prime256v1` | 256  | **ç­‰åŒäº `secp256r1`ï¼Œåªæ˜¯å‘½åä¸åŒ** |
| `secp384r1` | 384  | **é«˜å®‰å…¨æ€§ TLS** |
| `secp521r1` | 521  | **è¶…é«˜å®‰å…¨æ€§ï¼ˆå¤§å¯†é’¥ï¼‰** |

**è¯´æ˜**ï¼š
- `prime256v1` æ˜¯ `secp256r1` çš„åˆ«åï¼Œä¸¤è€…**å®Œå…¨ç›¸åŒ**ã€‚
- `secp256r1` æ˜¯ **ç›®å‰æœ€å¸¸ç”¨çš„æ›²çº¿**ï¼Œå¹¿æ³›ç”¨äº HTTPS å’Œç”µå­ç­¾åã€‚

---

#### SECG æ¤­åœ†æ›²çº¿ï¼ˆsecp ç³»åˆ—ï¼‰
- **æ ¼å¼**ï¼š`secpXXXk1`
- **æ¥æº**ï¼šSECï¼ˆStandards for Efficient Cryptography Groupï¼‰
- **ç‰¹ç‚¹**ï¼š
  - **`secp`**ï¼šè¡¨ç¤º "Standards for Efficient Cryptography Prime"
  - **`k1`**ï¼šè¡¨ç¤ºä½¿ç”¨ **Koblitz æ›²çº¿**ï¼Œæ¯” `r1` è®¡ç®—é€Ÿåº¦æ›´å¿«
  - **`XXX`**ï¼šæ›²çº¿çš„ä½æ•°

| **æ›²çº¿åç§°**  | **ä½æ•°** | **ç”¨é€”** |
|------------|------|------|
| `secp256k1` | 256  | **æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠã€åŒºå—é“¾** |

**è¯´æ˜**ï¼š
- `secp256k1` é‡‡ç”¨ **Koblitz æ›²çº¿**ï¼Œè®¡ç®—æ›´å¿«ï¼Œé€‚ç”¨äº**åŒºå—é“¾ç­¾åå’Œäº¤æ˜“**ã€‚
- **æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠ** éƒ½ä½¿ç”¨ `secp256k1`ï¼Œä½†å®ƒ**ä¸é€‚åˆä¸€èˆ¬ TLS/HTTPS**ã€‚

---

#### Bernstein æ¤­åœ†æ›²çº¿ï¼ˆX å’Œ Ed ç³»åˆ—ï¼‰
- **æ ¼å¼**ï¼š`X25519`ã€`Ed25519`
- **æ¥æº**ï¼šç”±å¯†ç å­¦ä¸“å®¶ **Daniel J. Bernstein** è®¾è®¡
- **ç‰¹ç‚¹**ï¼š
  - `X25519` ç”¨äº **å¯†é’¥äº¤æ¢**
  - `Ed25519` ç”¨äº **æ•°å­—ç­¾å**
  - è®¡ç®—é€Ÿåº¦æå¿«ï¼ŒæŠ—ä¾§ä¿¡é“æ”»å‡»ï¼Œé€‚åˆ IoTã€ç§»åŠ¨è®¾å¤‡ã€ç«¯åˆ°ç«¯åŠ å¯†


| **æ›²çº¿åç§°**  | **ä½æ•°** | **ç”¨é€”** |
|------------|------|------|
| `X25519` | 256 | **å¯†é’¥äº¤æ¢**ï¼ˆTLS 1.3 æ¨èï¼‰ |
| `Ed25519` | 256 | **æ•°å­—ç­¾å**ï¼ˆSSHã€GPGã€åŠ å¯†åè®®ï¼‰ |
| `X448` | 448 | **è¶…é«˜å®‰å…¨å¯†é’¥äº¤æ¢** |
| `Ed448` | 448 | **è¶…é«˜å®‰å…¨æ•°å­—ç­¾å** |

**è¯´æ˜**ï¼š
- `X25519` åœ¨ **TLS 1.3ã€Signalã€WhatsApp** ç­‰å¹¿æ³›ä½¿ç”¨ã€‚
- `Ed25519` é€Ÿåº¦å¿«ã€ç­¾åçŸ­ï¼Œè¢« SSHã€GPG é‡‡ç”¨ã€‚

## 2. `openssl ec` å‘½ä»¤

openssl ec å‘½ä»¤ç”¨äº ç®¡ç†æ¤­åœ†æ›²çº¿ï¼ˆECï¼‰å¯†é’¥ï¼ŒåŒ…æ‹¬ æŸ¥çœ‹ã€è½¬æ¢ã€å¯¼å‡ºå…¬é’¥ ä»¥åŠ æ£€æŸ¥å¯†é’¥ä¸€è‡´æ€§ã€‚

### å‚æ•°è¯¦è§£

| **ç±»åˆ«**         | **å‚æ•°**               | **è¯´æ˜** |
|-----------------|----------------------|---------|
| **è¾“å…¥é€‰é¡¹**    | `-in val`            | æŒ‡å®šè¾“å…¥å¯†é’¥æ–‡ä»¶ |
|                 | `-inform format`     | æŒ‡å®šè¾“å…¥æ ¼å¼ï¼Œå¯é€‰ `DER`ã€`PEM`ã€`P12`ã€`ENGINE` |
|                 | `-pubin`             | æŒ‡ç¤ºè¾“å…¥æ–‡ä»¶ä¸ºå…¬é’¥ |
|                 | `-passin val`        | æŒ‡å®šç§é’¥çš„å¯†ç æ¥æº |
|                 | `-check`             | æ£€æŸ¥å¯†é’¥çš„ä¸€è‡´æ€§ |
|                 | `-*`                 | ä½¿ç”¨æ”¯æŒçš„ä»»ä½•åŠ å¯†ç®—æ³• |
|                 | `-param_enc val`     | æŒ‡å®šæ¤­åœ†æ›²çº¿å‚æ•°çš„ç¼–ç æ–¹å¼ |
|                 | `-conv_form val`     | æŒ‡å®šç‚¹çš„è½¬æ¢æ ¼å¼ï¼ˆå‹ç¼©ã€æœªå‹ç¼©ç­‰ï¼‰ |
| **è¾“å‡ºé€‰é¡¹**    | `-out outfile`       | æŒ‡å®šè¾“å‡ºæ–‡ä»¶ |
|                 | `-outform PEM\|DER`  | æŒ‡å®šè¾“å‡ºæ ¼å¼ï¼š`DER` æˆ– `PEM` |
|                 | `-noout`             | ä¸è¾“å‡ºå¯†é’¥ï¼Œä»…æ‰§è¡Œæ“ä½œ |
|                 | `-text`              | ä»¥æ–‡æœ¬å½¢å¼æ‰“å°å¯†é’¥ä¿¡æ¯ |
|                 | `-param_out`         | è¾“å‡ºæ¤­åœ†æ›²çº¿å‚æ•° |
|                 | `-pubout`            | ä»…è¾“å‡ºå…¬é’¥ï¼Œä¸è¾“å‡ºç§é’¥ |
|                 | `-no_public`         | ä»ç§é’¥æ–‡ä»¶ä¸­æ’é™¤å…¬é’¥éƒ¨åˆ† |
|                 | `-passout val`       | æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„å¯†ç æ¥æº |
| **Provider é€‰é¡¹** | `-provider-path val` | æŒ‡å®š OpenSSL æä¾›è€…ï¼ˆproviderï¼‰è·¯å¾„ |
|                 | `-provider val`      | æŒ‡å®šè¦åŠ è½½çš„æä¾›è€…ï¼ˆå¯å¤šæ¬¡æŒ‡å®šï¼‰ |
|                 | `-propquery val`     | ç”¨äºè·å–ç®—æ³•æ—¶çš„å±æ€§æŸ¥è¯¢ |



## 3.ä½¿ç”¨ç¤ºä¾‹

### 3.1 æŸ¥çœ‹æ”¯æŒçš„æ¤­åœ†æ›²çº¿

```bash

openssl ecparam -list_curves
```

### 3.2 ç”Ÿæˆå¯†é’¥

```bash

# secp384r1
openssl ecparam -name prime256v1 -genkey -out prime256v1-raw.pem

# secp384r1
openssl ecparam -name secp384r1 -genkey -out secp384r1-raw.pem

# secp521r1
openssl ecparam -name secp521r1 -genkey -out secp521r1-raw.pem


# ed25519 ç”¨äºæ•°å­—ç­¾å
openssl genpkey -algorithm ed25519 -out ed25519-raw.pem

# x25519 ç”¨äºå¯†é’¥äº¤æ¢
openssl genpkey -algorithm x25519 -out x25519-raw.pem

```
æ³¨æ„ï¼š
- `genpkey` ç”Ÿæˆç§é’¥é»˜è®¤PKCS#8ç¼–ç 


### 3.3 æŸ¥çœ‹ç§é’¥/å…¬é’¥

```bash

# æŸ¥çœ‹ç§é’¥
openssl ec -in ed25519-raw.pem -text -noout

# æŸ¥çœ‹å…¬é’¥
openssl ec -pubin -in ed25519.pub -noout -text

```

### 3.4 åŠ å¯†/è§£å¯† å¯†é’¥

```bash

# åŠ å¯†
openssl pkcs8 -topk8 -v2 aes256 -in ed25519-raw.pem -out ed25519.pem

# è§£å¯†
openssl pkcs8 -topk8 -nocrypt -in ed25519.pem -out ed25519-raw.pem

```


### 3.6 æå–å…¬é’¥

```bash

openssl ec -in ed25519-raw.pem -pubout -out ed25519.pub
```

### 3.7 ECDSAç­¾å(secp384r1)

```bash

# ç­¾å
openssl dgst -sha256 -verify secp384r1-raw.pem -out data.sig data

# éªŒè¯
openssl dgst -sha256 -verify secp384r1.pub -signature data.sig data

```


### 3.8 EdDSAç­¾å (ed25519)

Ed25519 å’Œ Ed448 å†…éƒ¨è‡ªå¸¦å“ˆå¸Œè®¡ç®—ï¼Œå®ƒä»¬åœ¨ç­¾åæ—¶ä¼šè‡ªåŠ¨å¤„ç†æ•°æ®çš„å“ˆå¸Œï¼Œè€Œä¸æ˜¯ä¾èµ– `openssl dgst` æ‰‹åŠ¨è®¡ç®—

```bash

# ç­¾å
openssl pkeyutl -sign -inkey ed25519-raw.pem -rawin -in data -out data.sig

# éªŒè¯
openssl pkeyutl -verify -pubin -inkey ed25519.pub -sigfile data.sig -rawin -in data 

```

### 3.9 ECDHå¯†é’¥äº¤æ¢(x25519)

```bash

# server å¯†é’¥å¯¹

## ç§é’¥
openssl genpkey -algorithm x25519 -out x25519-raw-server.pem
## å…¬é’¥
openssl ec -in x25519-raw-server.pem -pubout -out x25519-raw-server.pub

# client å¯†é’¥å¯¹

## ç§é’¥
openssl genpkey -algorithm x25519 -out x25519-raw-client.pem
## å…¬é’¥
openssl ec -in x25519-raw-client.pem -pubout -out x25519-raw-client.pub

# è®¡ç®—å…±äº«å¯†é’¥

## server è®¡ç®—
openssl pkeyutl -derive -inkey x25519-raw-server.pem -peerkey x25519-raw-client.pub -out server.bin
## client è®¡ç®—
openssl pkeyutl -derive -inkey x25519-raw-client.pem -peerkey x25519-raw-server.pub -out client.bin

# æ£€æŸ¥

## æ£€æŸ¥server.bin
base64 server.bin
mMsyqXNK+XuaMB5dpx7/QQPXSthYEYcBK1PyXVBOhRQ=

## æ£€æŸ¥client.bin
base64 client.bin
mMsyqXNK+XuaMB5dpx7/QQPXSthYEYcBK1PyXVBOhRQ=
```
