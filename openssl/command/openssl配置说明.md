# openssl 配置说明


## 1.配置示例

示例文件来自: `/etc/ssl/openssl.cnf`

```ini
#
# OpenSSL example configuration file.
# See doc/man5/config.pod for more info.
#
# This is mostly being used for generation of certificate requests,
# but may be used for auto loading of providers

# Note that you can include other files from the main configuration
# file using the .include directive.
#.include filename

# This definition stops the following lines choking if HOME isn't
# defined.
HOME			= .

 # Use this in order to automatically load providers.
openssl_conf = openssl_init

# Comment out the next line to ignore configuration errors
config_diagnostics = 1

# Extra OBJECT IDENTIFIER info:
# oid_file       = $ENV::HOME/.oid
oid_section = new_oids

# To use this configuration file with the "-extfile" option of the
# "openssl x509" utility, name here the section containing the
# X.509v3 extensions to use:
# extensions		=
# (Alternatively, use a configuration file that has only
# X.509v3 extensions in its main [= default] section.)

[ new_oids ]
# We can add new OIDs in here for use by 'ca', 'req' and 'ts'.
# Add a simple OID like this:
# testoid1=1.2.3.4
# Or use config file substitution like this:
# testoid2=${testoid1}.5.6

# Policies used by the TSA examples.
tsa_policy1 = 1.2.3.4.1
tsa_policy2 = 1.2.3.4.5.6
tsa_policy3 = 1.2.3.4.5.7

# For FIPS
# Optionally include a file that is generated by the OpenSSL fipsinstall
# application. This file contains configuration data required by the OpenSSL
# fips provider. It contains a named section e.g. [fips_sect] which is
# referenced from the [provider_sect] below.
# Refer to the OpenSSL security policy for more information.
# .include fipsmodule.cnf

[openssl_init]
providers = provider_sect
ssl_conf = ssl_sect

# List of providers to load
[provider_sect]
default = default_sect
# The fips section name should match the section name inside the
# included fipsmodule.cnf.
# fips = fips_sect

# If no providers are activated explicitly, the default one is activated implicitly.
# See man 7 OSSL_PROVIDER-default for more details.
#
# If you add a section explicitly activating any other provider(s), you most
# probably need to explicitly activate the default provider, otherwise it
# becomes unavailable in openssl.  As a consequence applications depending on
# OpenSSL may not work correctly which could lead to significant system
# problems including inability to remotely access the system.
[default_sect]
# activate = 1


####################################################################
[ ca ]
default_ca	= CA_default		# The default ca section

####################################################################
[ CA_default ]

dir		= ./demoCA		# Where everything is kept
certs		= $dir/certs		# Where the issued certs are kept
crl_dir		= $dir/crl		# Where the issued crl are kept
database	= $dir/index.txt	# database index file.
#unique_subject	= no			# Set to 'no' to allow creation of
					# several certs with same subject.
new_certs_dir	= $dir/newcerts		# default place for new certs.

certificate	= $dir/cacert.pem 	# The CA certificate
serial		= $dir/serial 		# The current serial number
crlnumber	= $dir/crlnumber	# the current crl number
					# must be commented out to leave a V1 CRL
crl		= $dir/crl.pem 		# The current CRL
private_key	= $dir/private/cakey.pem# The private key

x509_extensions	= usr_cert		# The extensions to add to the cert

# Comment out the following two lines for the "traditional"
# (and highly broken) format.
name_opt 	= ca_default		# Subject Name options
cert_opt 	= ca_default		# Certificate field options

# Extension copying option: use with caution.
# copy_extensions = copy

# Extensions to add to a CRL. Note: Netscape communicator chokes on V2 CRLs
# so this is commented out by default to leave a V1 CRL.
# crlnumber must also be commented out to leave a V1 CRL.
# crl_extensions	= crl_ext

default_days	= 365			# how long to certify for
default_crl_days= 30			# how long before next CRL
default_md	= default		# use public key default MD
preserve	= no			# keep passed DN ordering

# A few difference way of specifying how similar the request should look
# For type CA, the listed attributes must be the same, and the optional
# and supplied fields are just that :-)
policy		= policy_match

# For the CA policy
[ policy_match ]
countryName		= match
stateOrProvinceName	= match
organizationName	= match
organizationalUnitName	= optional
commonName		= supplied
emailAddress		= optional

# For the 'anything' policy
# At this point in time, you must list all acceptable 'object'
# types.
[ policy_anything ]
countryName		= optional
stateOrProvinceName	= optional
localityName		= optional
organizationName	= optional
organizationalUnitName	= optional
commonName		= supplied
emailAddress		= optional

####################################################################
[ req ]
default_bits		= 2048
default_keyfile 	= privkey.pem
distinguished_name	= req_distinguished_name
attributes		= req_attributes
x509_extensions	= v3_ca	# The extensions to add to the self signed cert

# Passwords for private keys if not present they will be prompted for
# input_password = secret
# output_password = secret

# This sets a mask for permitted string types. There are several options.
# default: PrintableString, T61String, BMPString.
# pkix	 : PrintableString, BMPString (PKIX recommendation before 2004)
# utf8only: only UTF8Strings (PKIX recommendation after 2004).
# nombstr : PrintableString, T61String (no BMPStrings or UTF8Strings).
# MASK:XXXX a literal mask value.
# WARNING: ancient versions of Netscape crash on BMPStrings or UTF8Strings.
string_mask = utf8only

# req_extensions = v3_req # The extensions to add to a certificate request

[ req_distinguished_name ]
countryName			= Country Name (2 letter code)
countryName_default		= AU
countryName_min			= 2
countryName_max			= 2

stateOrProvinceName		= State or Province Name (full name)
stateOrProvinceName_default	= Some-State

localityName			= Locality Name (eg, city)

0.organizationName		= Organization Name (eg, company)
0.organizationName_default	= Internet Widgits Pty Ltd

# we can do this but it is not needed normally :-)
#1.organizationName		= Second Organization Name (eg, company)
#1.organizationName_default	= World Wide Web Pty Ltd

organizationalUnitName		= Organizational Unit Name (eg, section)
#organizationalUnitName_default	=

commonName			= Common Name (e.g. server FQDN or YOUR name)
commonName_max			= 64

emailAddress			= Email Address
emailAddress_max		= 64

# SET-ex3			= SET extension number 3

[ req_attributes ]
challengePassword		= A challenge password
challengePassword_min		= 4
challengePassword_max		= 20

unstructuredName		= An optional company name

[ usr_cert ]

# These extensions are added when 'ca' signs a request.

# This goes against PKIX guidelines but some CAs do it and some software
# requires this to avoid interpreting an end user certificate as a CA.

basicConstraints=CA:FALSE

# This is typical in keyUsage for a client certificate.
# keyUsage = nonRepudiation, digitalSignature, keyEncipherment

# PKIX recommendations harmless if included in all certificates.
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

# This stuff is for subjectAltName and issuerAltname.
# Import the email address.
# subjectAltName=email:copy
# An alternative to produce certificates that aren't
# deprecated according to PKIX.
# subjectAltName=email:move

# Copy subject details
# issuerAltName=issuer:copy

# This is required for TSA certificates.
# extendedKeyUsage = critical,timeStamping

[ v3_req ]

# Extensions to add to a certificate request

basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment

[ v3_ca ]


# Extensions for a typical CA


# PKIX recommendation.

subjectKeyIdentifier=hash

authorityKeyIdentifier=keyid:always,issuer

basicConstraints = critical,CA:true

# Key usage: this is typical for a CA certificate. However since it will
# prevent it being used as an test self-signed certificate it is best
# left out by default.
# keyUsage = cRLSign, keyCertSign

# Include email address in subject alt name: another PKIX recommendation
# subjectAltName=email:copy
# Copy issuer details
# issuerAltName=issuer:copy

# DER hex encoding of an extension: beware experts only!
# obj=DER:02:03
# Where 'obj' is a standard or added object
# You can even override a supported extension:
# basicConstraints= critical, DER:30:03:01:01:FF

[ crl_ext ]

# CRL extensions.
# Only issuerAltName and authorityKeyIdentifier make any sense in a CRL.

# issuerAltName=issuer:copy
authorityKeyIdentifier=keyid:always

[ proxy_cert_ext ]
# These extensions should be added when creating a proxy certificate

# This goes against PKIX guidelines but some CAs do it and some software
# requires this to avoid interpreting an end user certificate as a CA.

basicConstraints=CA:FALSE

# This is typical in keyUsage for a client certificate.
# keyUsage = nonRepudiation, digitalSignature, keyEncipherment

# PKIX recommendations harmless if included in all certificates.
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

# This stuff is for subjectAltName and issuerAltname.
# Import the email address.
# subjectAltName=email:copy
# An alternative to produce certificates that aren't
# deprecated according to PKIX.
# subjectAltName=email:move

# Copy subject details
# issuerAltName=issuer:copy

# This really needs to be in place for it to be a proxy certificate.
proxyCertInfo=critical,language:id-ppl-anyLanguage,pathlen:3,policy:foo

####################################################################
[ tsa ]

default_tsa = tsa_config1	# the default TSA section

[ tsa_config1 ]

# These are used by the TSA reply generation only.
dir		= ./demoCA		# TSA root directory
serial		= $dir/tsaserial	# The current serial number (mandatory)
crypto_device	= builtin		# OpenSSL engine to use for signing
signer_cert	= $dir/tsacert.pem 	# The TSA signing certificate
					# (optional)
certs		= $dir/cacert.pem	# Certificate chain to include in reply
					# (optional)
signer_key	= $dir/private/tsakey.pem # The TSA private key (optional)
signer_digest  = sha256			# Signing digest to use. (Optional)
default_policy	= tsa_policy1		# Policy if request did not specify it
					# (optional)
other_policies	= tsa_policy2, tsa_policy3	# acceptable policies (optional)
digests     = sha1, sha256, sha384, sha512  # Acceptable message digests (mandatory)
accuracy	= secs:1, millisecs:500, microsecs:100	# (optional)
clock_precision_digits  = 0	# number of digits after dot. (optional)
ordering		= yes	# Is ordering defined for timestamps?
				# (optional, default: no)
tsa_name		= yes	# Must the TSA name be included in the reply?
				# (optional, default: no)
ess_cert_id_chain	= no	# Must the ESS cert id chain be included?
				# (optional, default: no)
ess_cert_id_alg		= sha1	# algorithm to compute certificate
				# identifier (optional, default: sha1)

[insta] # CMP using Insta Demo CA
# Message transfer
server = pki.certificate.fi:8700
# proxy = # set this as far as needed, e.g., http://192.168.1.1:8080
# tls_use = 0
path = pkix/

# Server authentication
recipient = "/C=FI/O=Insta Demo/CN=Insta Demo CA" # or set srvcert or issuer
ignore_keyusage = 1 # potentially needed quirk
unprotected_errors = 1 # potentially needed quirk
extracertsout = insta.extracerts.pem

# Client authentication
ref = 3078 # user identification
secret = pass:insta # can be used for both client and server side

# Generic message options
cmd = ir # default operation, can be overridden on cmd line with, e.g., kur

# Certificate enrollment
subject = "/CN=openssl-cmp-test"
newkey = insta.priv.pem
out_trusted = insta.ca.crt
certout = insta.cert.pem

[pbm] # Password-based protection for Insta CA
# Server and client authentication
ref = $insta::ref # 3078
secret = $insta::secret # pass:insta

[signature] # Signature-based protection for Insta CA
# Server authentication
trusted = insta.ca.crt # does not include keyUsage digitalSignature

# Client authentication
secret = # disable PBM
key = $insta::newkey # insta.priv.pem
cert = $insta::certout # insta.cert.pem

[ir]
cmd = ir

[cr]
cmd = cr

[kur]
# Certificate update
cmd = kur
oldcert = $insta::certout # insta.cert.pem

[rr]
# Certificate revocation
cmd = rr
oldcert = $insta::certout # insta.cert.pem

[ssl_sect]
system_default = system_default_sect

[system_default_sect]
CipherString = DEFAULT:@SECLEVEL=2
```


```ini

#
# OpenSSL 示例配置文件。
# 更多信息请参阅 doc/man5/config.pod。
#
# 此文件主要用于生成证书请求，
# 但也可用于自动加载提供程序。

# 请注意，您可以使用 .include 指令从主配置文件中包含其他文件。
#.include filename

# 如果未定义 HOME，则此定义可防止以下行出错。
HOME			= .

# 使用此设置自动加载提供程序。
openssl_conf = openssl_init

# 注释掉下一行以忽略配置错误
config_diagnostics = 1

# 额外的 OBJECT IDENTIFIER 信息：
# oid_file		= $ENV::HOME/.oid
oid_section = new_oids

# 要将此配置文件与 "openssl x509" 实用程序的 "-extfile" 选项一起使用，请在此处命名包含要使用的 X.509v3 扩展的节：
# extensions		=
# （或者，使用一个配置文件，该文件在其主 [= default] 节中仅包含 X.509v3 扩展。）

[ new_oids ]
# 我们可以在此处添加新的 OID，供 'ca'、'req' 和 'ts' 使用。
# 添加一个简单的 OID，如下所示：
# testoid1=1.2.3.4
# 或使用配置文件替换，如下所示：
# testoid2=${testoid1}.5.6

# TSA 示例使用的策略。
tsa_policy1 = 1.2.3.4.1
tsa_policy2 = 1.2.3.4.5.6
tsa_policy3 = 1.2.3.4.5.7

# 用于 FIPS
# 可选地包含由 OpenSSL fipsinstall 应用程序生成的文件。
# 此文件包含 OpenSSL fips 提供程序所需的配置数据。
# 它包含一个命名节，例如 [fips_sect]，该节从下面的 [provider_sect] 中引用。
# 有关更多信息，请参阅 OpenSSL 安全策略。
# .include fipsmodule.cnf

[openssl_init]
providers = provider_sect
ssl_conf = ssl_sect

# 要加载的提供程序列表
[provider_sect]
default = default_sect
# fips 节名称应与包含的 fipsmodule.cnf 中的节名称匹配。
# fips = fips_sect

# 如果没有显式激活提供程序，则隐式激活默认提供程序。
# 有关更多详细信息，请参阅 man 7 OSSL_PROVIDER-default。
#
# 如果您添加一个显式激活任何其他提供程序的节，则很可能需要显式激活默认提供程序，否则它将在 openssl 中不可用。
# 因此，依赖于 OpenSSL 的应用程序可能无法正常工作，这可能导致严重的系统问题，包括无法远程访问系统。
[default_sect]
# activate = 1


####################################################################
[ ca ]
default_ca	= CA_default		# 默认 CA 节

####################################################################
[ CA_default ]

dir		= ./demoCA		# 所有内容保存的位置
certs		= $dir/certs		# 已颁发证书的保存位置
crl_dir		= $dir/crl		# 已颁发 CRL 的保存位置
database	= $dir/index.txt	# 数据库索引文件。
#unique_subject	= no			# 设置为“no”以允许创建具有相同主题的多个证书。
new_certs_dir	= $dir/newcerts		# 新证书的默认位置。

certificate	= $dir/cacert.pem 	# CA 证书
serial		= $dir/serial 		# 当前序列号
crlnumber	= $dir/crlnumber	# 当前 CRL 编号
					# 必须注释掉以保留 V1 CRL
crl		= $dir/crl.pem 		# 当前 CRL
private_key	= $dir/private/cakey.pem# 私钥

x509_extensions	= usr_cert		# 要添加到证书的扩展

# 注释掉以下两行以使用“传统”（且严重损坏）的格式。
name_opt 	= ca_default		# 主题名称选项
cert_opt 	= ca_default		# 证书字段选项

# 扩展复制选项：谨慎使用。
# copy_extensions = copy

# 要添加到 CRL 的扩展。注意：Netscape 通信程序在 V2 CRL 上出现问题，
# 因此默认情况下已注释掉以保留 V1 CRL。
# crlnumber 也必须注释掉以保留 V1 CRL。
# crl_extensions	= crl_ext

default_days	= 365			# 证书有效期
default_crl_days= 30			# 下一个 CRL 之前的有效期
default_md	= default		# 使用公钥默认 MD
preserve	= no			# 保留传递的 DN 顺序

# 指定请求应如何相似的几种不同方式
# 对于 CA 类型，列出的属性必须相同，可选和提供的字段就是这样 :-)
policy		= policy_match

# 对于 CA 策略
[ policy_match ]
countryName		= match
stateOrProvinceName	= match
organizationName	= match
organizationalUnitName	= optional
commonName		= supplied
emailAddress		= optional

# 对于“任何”策略
# 此时，您必须列出所有可接受的“对象”类型。
[ policy_anything ]
countryName		= optional
stateOrProvinceName	= optional
localityName		= optional
organizationName	= optional
organizationalUnitName	= optional
commonName		= supplied
emailAddress		= optional

####################################################################
[ req ]
default_bits		= 2048
default_keyfile 	= privkey.pem
distinguished_name	= req_distinguished_name
attributes		= req_attributes
x509_extensions	= v3_ca	# 要添加到自签名证书的扩展

# 私钥的密码（如果不存在，将提示输入）
# input_password = secret
# output_password = secret

# 这为允许的字符串类型设置掩码。有几个选项。
# default：PrintableString、T61String、BMPString。
# pkix：PrintableString、BMPString（2004 年之前的 PKIX 建议）
# utf8only：仅限 UTF8Strings（2004 年之后的 PKIX 建议）。
# nombstr：PrintableString、T61String（无 BMPStrings 或 UTF8Strings）。
# MASK:XXXX 文字掩码值。
# 警告：Netscape 的旧版本在 BMPStrings 或 UTF8Strings 上崩溃。
string_mask = utf8only

# req_extensions = v3_req # 要添加到证书请求的扩展

[ req_distinguished_name ]
countryName			= 国家名称（2 个字母的代码）
countryName_default		= AU
countryName_min			= 2
countryName_max			= 2

stateOrProvinceName		= 州或省份名称（全名）
stateOrProvinceName_default	= Some-State

localityName			= 地区名称（例如，城市）

0.organizationName		= 组织名称（例如，公司）
0.organizationName_default	= Internet Widgits Pty Ltd

# 我们可以这样做，但通常不需要 :-)
#1.organizationName		= 第二组织名称（例如，公司）
#1.organizationName_default	= World Wide Web Pty Ltd

organizationalUnitName		= 组织单位名称（例如，部门）
#organizationalUnitName_default	=

commonName			= 通用名称（例如，服务器 FQDN 或您的姓名）
commonName_max			= 64

emailAddress			= 电子邮件地址
emailAddress_max		= 64

# SET-ex3			= SET 扩展编号 3

[ req_attributes ]
challengePassword		= 质询密码
challengePassword_min		= 4
challengePassword_max		= 20

unstructuredName		= 可选的公司名称

[ usr_cert ]

# 在“ca”签署请求时添加这些扩展。

# 这违反了 PKIX 指南，但某些 CA 这样做，并且某些软件
# 需要这样做，以避免将最终用户证书解释为 CA。

basicConstraints=CA:FALSE

# 这是客户端证书的 keyUsage 中的典型用法。
# keyUsage = nonRepudiation, digitalSignature, keyEncipherment

# 如果包含在所有证书中，则 PKIX 建议无害。
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

# 这些内容用于 subjectAltName 和 issuerAltname。
# 导入电子邮件地址。
# subjectAltName=email:copy
# 生成未根据 PKIX 弃用的证书的替代方法。
# subjectAltName=email:move

# 复制主题详细信息
# issuerAltName=issuer:copy

# 这是 TSA 证书所必需的。
# extendedKeyUsage = critical,timeStamping

[ v3_req ]

# 要添加到证书请求的扩展

basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment

[ v3_ca ]


# 典型 CA 的扩展


# PKIX 建议。

subjectKeyIdentifier=hash

authorityKeyIdentifier=keyid:always,issuer

basicConstraints = critical,CA:true

# 密钥用法：这是 CA 证书的典型用法。但是，由于它将
# 阻止将其用作测试自签名证书，因此最好
# 默认情况下将其省略。
# keyUsage = cRLSign, keyCertSign

# 在主题备用名称中包含电子邮件地址：另一个 PKIX 建议
# subjectAltName=email:copy
# 复制颁发者详细信息
# issuerAltName=issuer:copy

# 扩展的 DER 十六进制编码：仅限专家！
# obj=DER:02:03
# 其中“obj”是标准或添加的对象
# 您甚至可以覆盖受支持的扩展：
# basicConstraints= critical, DER:30:03:01:01:FF

[ crl_ext ]

# CRL 扩展。
# 只有 issuerAltName 和 authorityKeyIdentifier 在 CRL 中才有意义。

# issuerAltName=issuer:copy
authorityKeyIdentifier=keyid:always

[ proxy_cert_ext ]
# 创建代理证书时应添加这些扩展

# 这违反了 PKIX 指南，但某些 CA 这样做，并且某些软件
# 需要这样做，以避免将最终用户证书解释为 CA。

basicConstraints=CA:FALSE

# 这是客户端证书的 keyUsage 中的典型用法。
# keyUsage = nonRepudiation, digitalSignature, keyEncipherment

# 如果包含在所有证书中，则 PKIX 建议无害。
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

# 这些内容用于 subjectAltName 和 issuerAltname。
# 导入电子邮件地址。
# subjectAltName=email:copy
# 生成未根据 PKIX 弃用的证书的替代方法。
# subjectAltName=email:move

# 复制主题详细信息
# issuerAltName=issuer:copy

# 这对于代理证书来说确实是必需的。
proxyCertInfo=critical,language:id-ppl-anyLanguage,pathlen:3,policy:foo

####################################################################
[ tsa ]

default_tsa = tsa_config1	# 默认 TSA 节

[ tsa_config1 ]

# 这些仅由 TSA 回复生成使用。
dir		= ./demoCA		# TSA 根目录
serial		= $dir/tsaserial	# 当前序列号（强制性）
crypto_device	= builtin		# 用于签名的 OpenSSL 引擎
signer_cert	= $dir/tsacert.pem 	# TSA 签名证书（可选）
					# (optional)
certs		= $dir/cacert.pem	# 要包含在回复中的证书链（可选）
					# (optional)
signer_key	= $dir/private/tsakey.pem # TSA 私钥（可选）
signer_digest	= sha256			# 要使用的签名摘要。（可选）
default_policy	= tsa_policy1		# 如果请求未指定策略，则使用此策略（可选）
					# (optional)
other_policies	= tsa_policy2, tsa_policy3	# 可接受的策略（可选）
digests		= sha1, sha256, sha384, sha512	# 可接受的消息摘要（强制性）
accuracy	= secs:1, millisecs:500, microsecs:100	# (可选)
clock_precision_digits	= 0	# 小数点后的位数。（可选）
ordering		= yes	# 是否为时间戳定义了顺序？
				# （可选，默认：否）
tsa_name		= yes	# 是否必须在回复中包含 TSA 名称？
				# （可选，默认：否）
ess_cert_id_chain	= no	# 是否必须包含 ESS 证书 ID 链？
				# （可选，默认：否）
ess_cert_id_alg		= sha1	# 计算证书的算法
				# 标识符（可选，默认：sha1）

[insta] # 使用 Insta Demo CA 的 CMP
# 消息传输
server = pki.certificate.fi:8700
# proxy = # 根据需要设置此项，例如，http://192.168.1.1:8080
# tls_use = 0
path = pkix/

# 服务器身份验证
recipient = "/C=FI/O=Insta Demo/CN=Insta Demo CA" # 或设置 srvcert 或 issuer
ignore_keyusage = 1 # 可能需要的怪癖
unprotected_errors = 1 # 可能需要的怪癖
extracertsout = insta.extracerts.pem

# 客户端身份验证
ref = 3078 # 用户标识
secret = pass:insta # 可用于客户端和服务器端

# 通用消息选项
cmd = ir # 默认操作，可以使用命令行覆盖，例如，kur

# 证书注册
subject = "/CN=openssl-cmp-test"
newkey = insta.priv.pem
out_trusted = insta.ca.crt
certout = insta.cert.pem

[pbm] # Insta CA 的基于密码的保护
# 服务器和客户端身份验证
ref = $insta::ref # 3078
secret = $insta::secret # pass:insta

[signature] # Insta CA 的基于签名的保护
# 服务器身份验证
trusted = insta.ca.crt # 不包括 keyUsage digitalSignature

# 客户端身份验证
secret = # 禁用 PBM
key = $insta::newkey # insta.priv.pem
cert = $insta::certout # insta.cert.pem

[ir]
cmd = ir

[cr]
cmd = cr

[kur]
# 证书更新
cmd = kur
oldcert = $insta::certout # insta.cert.pem

[rr]
# 证书撤销
cmd = rr
oldcert = $insta::certout # insta.cert.pem

[ssl_sect]
system_default = system_default_sect

[system_default_sect]
CipherString = DEFAULT:@SECLEVEL=2
```

## 2.全局配置

### **HOME**
```ini
HOME = .
```
- 指定 OpenSSL 配置文件的工作目录，默认为当前目录 (`.`)。
- 影响其他相对路径配置，如 `dir = ./demoCA`。

### **openssl_conf**
```ini
openssl_conf = openssl_init
```
- 定义 OpenSSL 初始化部分的配置，在 `[openssl_init]` 里指定要加载的 provider 和 SSL 配置。

### **config_diagnostics**
```ini
config_diagnostics = 1
```
- 启用 OpenSSL 配置错误的诊断，设置 `1` 可以在遇到配置错误时提供详细的错误信息。

### **OBJECT IDENTIFIER（OID）定义**
```ini
oid_section = new_oids
```
- `new_oids` 指向 `[ new_oids ]` 配置块，可以添加自定义 OID。

---

## 3.Provider 相关配置
### **OpenSSL 3.0+ 的 Provider 加载**
```ini
[openssl_init]
providers = provider_sect
ssl_conf = ssl_sect
```
- 指定 OpenSSL 启动时要加载的 provider 和 SSL 配置。

### **Provider 列表**
```ini
[provider_sect]
default = default_sect
# fips = fips_sect
```
- `default` 指向 `[default_sect]`，默认加载 OpenSSL 内置的加密算法。
- `fips` 需要 FIPS 140-2 认证的环境才会启用，默认注释。

### **默认 Provider 配置**
```ini
[default_sect]
# activate = 1
```
- 可选参数 `activate = 1`，用于显式启用 `default` provider，否则 OpenSSL 会自动加载。

---

## 4.CA（证书颁发机构）管理
### **CA 默认配置**
```ini
[ ca ]
default_ca = CA_default
```
- 设定默认的 CA 配置块为 `[CA_default]`。

### **CA 目录结构**
```ini
[ CA_default ]
dir = ./demoCA
certs = $dir/certs
crl_dir = $dir/crl
database = $dir/index.txt
new_certs_dir = $dir/newcerts
certificate = $dir/cacert.pem
serial = $dir/serial
crlnumber = $dir/crlnumber
crl = $dir/crl.pem
private_key = $dir/private/cakey.pem
```
- `dir`：CA 根目录。
- `certs`：存放已签发的证书。
- `crl_dir`：存放证书吊销列表 (CRL)。
- `database`：证书数据库 (`index.txt` 记录已签发证书)。
- `new_certs_dir`：存放新证书。
- `certificate`：CA 证书 (`cacert.pem`)。
- `serial`：证书序列号文件 (`serial`)。
- `crlnumber`：CRL 序列号 (`crlnumber`)。
- `crl`：CRL 文件 (`crl.pem`)。
- `private_key`：CA 私钥 (`cakey.pem`)。

### **证书签发规则**
```ini
default_days = 365
default_crl_days = 30
default_md = default
policy = policy_match
```
- `default_days`：证书有效期（默认为 365 天）。
- `default_crl_days`：CRL 证书有效期（默认为 30 天）。
- `default_md`：默认签名哈希算法。
- `policy`：证书签发策略，使用 `[policy_match]`。

### **证书签发策略**
```ini
[ policy_match ]
countryName = match
stateOrProvinceName = match
organizationName = match
organizationalUnitName = optional
commonName = supplied
emailAddress = optional
```
- `match`：必须与 CA 证书一致。
- `optional`：可选。
- `supplied`：必须提供。

---

## 5.证书请求配置
### **证书请求（CSR）默认参数**
```ini
[ req ]
default_bits = 2048
default_keyfile = privkey.pem
distinguished_name = req_distinguished_name
attributes = req_attributes
x509_extensions = v3_ca
string_mask = utf8only
```
- `default_bits`：生成的密钥长度（默认为 2048 位）。
- `default_keyfile`：默认私钥文件名。
- `distinguished_name`：指向 `[req_distinguished_name]`，定义证书主题字段。
- `attributes`：指向 `[req_attributes]`，定义额外属性。
- `x509_extensions`：证书扩展字段，默认为 `[v3_ca]`。
- `string_mask`：使用 UTF-8 编码（`utf8only`）。

### **证书主题字段**
```ini
[ req_distinguished_name ]
countryName = Country Name (2 letter code)
countryName_default = AU
stateOrProvinceName = State or Province Name (full name)
stateOrProvinceName_default = Some-State
localityName = Locality Name (eg, city)
0.organizationName = Organization Name (eg, company)
0.organizationName_default = Internet Widgits Pty Ltd
commonName = Common Name (e.g. server FQDN or YOUR name)
commonName_max = 64
emailAddress = Email Address
emailAddress_max = 64
```
- 定义 `CN`（通用名称）、`O`（组织）、`C`（国家）等证书信息。

### **证书请求扩展**
```ini
[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
```
- `basicConstraints = CA:FALSE`：该证书不可用于签发其他证书（非 CA 证书）。
- `keyUsage`：
  - `nonRepudiation`（不可否认性）
  - `digitalSignature`（数字签名）
  - `keyEncipherment`（密钥加密）

---

## 6.证书扩展
### **用户证书扩展**
```ini
[ usr_cert ]
basicConstraints=CA:FALSE
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer
```
- `basicConstraints = CA:FALSE`：用户证书，不能签发其他证书。
- `subjectKeyIdentifier = hash`：使用密钥哈希作为标识符。
- `authorityKeyIdentifier = keyid,issuer`：添加颁发者信息。

### **CA 证书扩展**
```ini
[ v3_ca ]
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid:always,issuer
basicConstraints = critical,CA:true
```
- `basicConstraints = critical,CA:true`：CA 证书，必须启用 `critical`。

---

## 7.时间戳服务（TSA）
### **时间戳服务配置**
```ini
[ tsa ]
default_tsa = tsa_config1
```
- `default_tsa`：默认时间戳服务配置，指向 `[tsa_config1]`。

### **TSA 配置**
```ini
[ tsa_config1 ]
dir = ./demoCA
serial = $dir/tsaserial
crypto_device = builtin
signer_cert = $dir/tsacert.pem
certs = $dir/cacert.pem
signer_key = $dir/private/tsakey.pem
signer_digest = sha256
```
- `signer_cert`：TSA 证书。
- `signer_key`：TSA 私钥。
- `signer_digest`：签名算法（`sha256`）。

---

