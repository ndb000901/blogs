# c++基础-变量作用域

## 1. 作用域（Scope）

**作用域**：变量或函数名在代码中**可见、有效**的范围。

一句话：**你在哪里能用这个变量，它的作用域就在那。**

---

## 2. 作用域的分类

### 2.1 **块级作用域（Block Scope）**

- 出现在 `{}` 花括号中的变量。
- 最常见于函数体、`if/for/while` 等语句块。

```cpp
void foo() {
    int x = 10;  // x 的作用域仅在 foo 内
    {
        int y = 20; // y 只在这个块内可见
    }
    // y 在这里不可见，访问会报错
}
```

> 小技巧：不同作用域可以定义相同变量名，但会**隐藏外层变量**。

---

### 2.2 **函数作用域（Function Scope）**

- 标签（如 `goto` 目标）是函数作用域的例子。
- 变量则是**块级作用域**，函数本身作用于整个文件/命名空间。

```cpp
void func() {
label:
    int a = 1;
    goto label; // 合法，但会死循环
}
```

---

### 2.3 **类作用域（Class Scope）**

- 成员变量和成员函数的作用域是类体内。

```cpp
class A {
    int x;         // 类作用域：仅成员函数可直接访问
public:
    void setX(int val) { x = val; }
};
```

---

### 2.4 **命名空间作用域（Namespace Scope）**

- 定义在 `namespace` 中的变量或函数，只在该命名空间中可见。

```cpp
namespace my {
    int val = 100;
}

int main() {
    std::cout << my::val;  // 使用命名空间前缀访问
}
```

---

### 2.5 **文件作用域（File Scope / 全局作用域）**

- 函数外定义的变量在整个文件中都可见。
- 如果不加 `static`，甚至能跨文件访问（外部链接）。

```cpp
int gVar = 10;    // 文件作用域，链接外部可访问

static int sVar = 5;  // 仅限当前文件，内部链接
```

---

### 2.6 **表达式作用域（C++17 起）**

```cpp
if (int x = foo(); x > 0) {
    // x 的作用域仅在 if 表达式和它的语句块中
}
```

---

## 3. 生命周期 vs 作用域

| 存储类型      | 生命周期                     | 作用域       |
|---------------|------------------------------|--------------|
| 自动变量       | 进入作用域时创建，退出销毁     | 块级作用域    |
| 静态变量       | 程序启动时创建，结束时销毁     | 块级 or 全局 |
| 全局变量       | 程序启动时创建，结束时销毁     | 全局作用域    |
| 动态变量（new）| `new` 时创建，`delete` 销毁  | 由指针决定   |

---


