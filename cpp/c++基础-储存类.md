# c++基础-储存类

## 1. 储存类概述

C++ 的**储存类（Storage Class）** 用于说明变量或函数的：

- **生命周期**（何时创建、何时销毁）
- **作用域**（能在程序的哪些位置访问）
- **可见性**（链接类型）
- **内存分配方式**（是否保留内存）

---


| 储存类关键字 | 生命周期    | 作用域       | 默认初始值     | 链接类型   | 常见用途                   |
|--------------|-------------|--------------|----------------|------------|----------------------------|
| `auto`       | 当前作用域  | 局部         | 不确定         | 无链接     | **默认**局部变量储存类（C++11后几乎不用） |
| `register`   | 当前作用域  | 局部         | 不确定         | 无链接     | 建议将变量放入 CPU 寄存器（已弃用）  |
| `static`     | 程序运行期间| 局部/全局    | 零初始化       | 内部链接   | 局部静态变量 / 内部函数           |
| `extern`     | 程序运行期间| 全局         | 外部文件决定   | 外部链接   | 引用其他文件中的变量或函数        |
| `mutable`    | 跟随对象    | 成员变量     | 未初始化       | 无链接     | 允许 const 对象修改此字段        |
| `thread_local` | 每线程     | 局部/全局    | 零初始化       | 线程链接   | C++11 起支持线程局部存储         |

---

### 1.1 `auto`（自动储存类）

> C++98 中默认局部变量使用 `auto`（可省略），**C++11 起 `auto` 表示自动类型推导，不是储存类关键字。**

```cpp
auto int x = 5; // C++98 用法（现在弃用）
auto x = 5;     // C++11 起，自动类型推导（与储存类无关）
```

---

### 1.2 `register`（寄存器变量，已弃用）

> 建议将变量存储在 CPU 寄存器中（不保证）。**不能获取地址（不能用 `&`）**。

```cpp
register int counter = 0;
// printf("%p", &counter); // 错误
```

编译器自动优化寄存器使用，不需要手动写 `register`。

---

### 1.3 `static`（静态储存类）

#### 用于局部变量：只初始化一次，生命周期持续到程序结束。

```cpp
void func() {
    static int count = 0;
    count++;
    std::cout << count << std::endl;
}
```

#### 用于全局变量或函数：限制链接类型为内部链接（仅当前文件可见）。

```cpp
static int global_counter = 0;

static void helper() {
    // 仅本文件可调用
}
```

---

### 1.4 `extern`（外部链接储存类）

> 告诉编译器变量或函数在别的地方定义。

```cpp
// file1.cpp
int shared_value = 100;

// file2.cpp
extern int shared_value; // 声明，不分配内存
```

用于多个源文件共享变量或函数。

---

### 1.5 `mutable`（可变成员）

> 允许 `const` 对象修改这个成员。

```cpp
class Logger {
    mutable int log_count = 0;
public:
    void log() const {
        log_count++; // 合法，mutable允许修改
    }
};
```

---

### 1.6 `thread_local`（C++11 起）

> 表示变量在每个线程中都有一份副本。

```cpp
thread_local int tid = 0;

void update() {
    tid++; // 每个线程独立更新
}
```

适合线程上下文缓存、线程内状态隔离等。

---

## 2. 生命周期对比表

| 关键字         | 变量创建时间           | 变量销毁时间         |
|----------------|------------------------|------------------------|
| auto           | 进入作用域             | 离开作用域             |
| register       | 进入作用域             | 离开作用域             |
| static         | 程序开始               | 程序结束               |
| extern         | 程序开始（由定义决定） | 程序结束               |
| thread_local   | 线程开始               | 线程结束               |


