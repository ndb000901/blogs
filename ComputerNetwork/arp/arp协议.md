# ARP 协议


ARP（Address Resolution Protocol，地址解析协议）是一个非常基础但关键的协议，用于在 **局域网（LAN）** 中将 IP 地址解析为 MAC 地址。它运行在数据链路层（OSI 第2层）和网络层（第3层）之间，帮助 IP 协议正常发送数据。

---

## 资料

- [wireshark下载](https://www.wireshark.org/download.html)
- [数据包下载](./packet/arp.pcapng)
- `packet/arp.pcapng` 使用wireshark 打开


## 1. 为什么需要 ARP

以太网通信依赖 **MAC 地址**，而 IP 协议只知道 **IP 地址**。

假设主机 A 要与同一网段的主机 B 通信，A 只知道 B 的 IP 地址，但不知道其 MAC 地址，于是需要使用 ARP：

> “根据 IP 地址找 MAC 地址。”

---

## 2. ARP 协议的工作流程（请求与响应）

### ARP 请求（Request）
- 主机 A 需要知道 IP 地址为 `192.168.1.2` 的主机的 MAC 地址。
- 它广播一个 ARP 请求帧，内容大致为：
  ```
  谁是 192.168.1.2？请告诉我你的 MAC 地址，我是 192.168.1.1，MAC 是 AA:AA:AA:AA:AA:AA。
  ```

### ARP 响应（Reply）
- IP 为 `192.168.1.2` 的主机收到 ARP 请求后会单播一个 ARP 响应回去，内容大致为：
  ```
  我是 192.168.1.2，我的 MAC 是 BB:BB:BB:BB:BB:BB。
  ```

- 主机 A 收到响应后，会将 IP-MAC 对应关系缓存到本地 ARP 表（通常有效期几分钟），避免下次重复请求。

---

## 3. ARP 数据包格式（总长度固定为 28 字节）

```
+-------------------+---------------------+
| Hardware Type     | Ethernet (0x0001)   |
+-------------------+---------------------+
| Protocol Type     | IPv4 (0x0800)       |
+-------------------+---------------------+
| HW Addr Length    | 6                   |
+-------------------+---------------------+
| Proto Addr Length | 4                   |
+-------------------+---------------------+
| Operation         | 1 (Request)         |
+-------------------+---------------------+
| Sender MAC        | AA:AA:AA:AA:AA:AA   |
+-------------------+---------------------+
| Sender IP         | 192.168.1.1         |
+-------------------+---------------------+
| Target MAC        | 00:00:00:00:00:00   |
+-------------------+---------------------+
| Target IP         | 192.168.1.2         |
+-------------------+---------------------+
```

| 字段             | 长度（字节） | 含义 |
|------------------|--------------|------|
| 硬件类型         | 2            | 一般为 1，表示以太网 |
| 协议类型         | 2            | 一般为 0x0800，表示 IPv4 |
| 硬件地址长度     | 1            | 一般为 6（MAC地址长度） |
| 协议地址长度     | 1            | 一般为 4（IPv4地址长度） |
| 操作码           | 2            | 1=ARP请求，2=ARP响应 |
| 发送方 MAC 地址  | 6            | 发起ARP的设备MAC地址 |
| 发送方 IP 地址   | 4            | 发起ARP的设备IP地址 |
| 目标 MAC 地址    | 6            | 目标设备的MAC地址（请求时为全0） |
| 目标 IP 地址     | 4            | 目标设备的IP地址 |

---

---


## 4. ARP 欺骗（ARP Spoofing）

由于 ARP 没有身份验证机制，攻击者可以发送伪造的 ARP 响应包，导致受害主机将错误的 MAC 地址绑定到目标 IP 上，实现中间人攻击（MITM）。

---

