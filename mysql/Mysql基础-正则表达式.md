# Mysql基础-正则表达式

## 1. 基本的正则表达式语法

MySQL 使用的是 **POSIX 1003.2** 标准的正则表达式语法，支持多种正则表达式的功能，包括常见的字符类、量词、锚点等。下面是常用的正则表达式符号及其含义。

### 常见正则表达式符号

| 符号      | 说明                                                   | 示例                            |
|---------|--------------------------------------------------------|-------------------------------|
| `.`     | 匹配任意单个字符（除换行符外）。                          | `a.b` 匹配 `acb`、`axb`、`aab` 等。 |
| `^`     | 匹配字符串的开始位置。                                   | `^abc` 匹配以 `abc` 开头的字符串。      |
| `$`     | 匹配字符串的结束位置。                                   | `abc$` 匹配以 `abc` 结尾的字符串。      |
| `[]`    | 字符集，匹配其中任意一个字符。                           | `[a-z]` 匹配小写字母。               |
| `[^ ]`  | 否定字符集，匹配不在字符集中的任意字符。                 | `[^0-9]` 匹配非数字字符。             |
| `\|`    | 或操作，匹配两个子表达式中的任意一个。                   | `a\|b` 匹配 `a` 或 `b`。          |
| `()`    | 捕获组，用来分组，后续可以引用该组。                     | `(abc)` 匹配 `abc`。             |
| `*`     | 匹配前面的表达式 0 次或多次。                           | `a*` 匹配 0 个或多个 `a`。           |
| `+`     | 匹配前面的表达式 1 次或多次。                           | `a+` 匹配 1 个或多个 `a`。           |
| `?`     | 匹配前面的表达式 0 次或 1 次。                          | `a?` 匹配 0 个或 1 个 `a`。         |
| `{n}`   | 匹配前面的表达式恰好 n 次。                              | `a{3}` 匹配 `aaa`。              |
| `{n,}`  | 匹配前面的表达式至少 n 次。                             | `a{3,}` 匹配 3 个或更多个 `a`。       |
| `{n,m}` | 匹配前面的表达式 n 到 m 次。                             | `a{2,4}` 匹配 2 到 4 个 `a`。      |
| `\`     | 转义字符，用于转义特殊字符或表示特殊字符。               | `\.` 匹配点符号 `.`。               |

### 特殊字符

| 符号     | 说明                         | 示例        |
|----------|------------------------------|-------------|
| `\d`     | 匹配任何数字字符 `[0-9]`      | `\d` 匹配 `1`、`2` 等 |
| `\D`     | 匹配任何非数字字符            | `\D` 匹配 `a`、`b` 等 |
| `\w`     | 匹配任何字母数字字符 `[a-zA-Z0-9_]` | `\w` 匹配 `a`、`A`、`1` 等 |
| `\W`     | 匹配任何非字母数字字符        | `\W` 匹配 `!`、`@` 等 |
| `\s`     | 匹配任何空白字符              | `\s` 匹配空格、制表符等 |
| `\S`     | 匹配任何非空白字符            | `\S` 匹配 `a`、`1` 等 |

---

## 2. REGEXP 和 RLIKE

在 MySQL 中，通过 `REGEXP` 或 `RLIKE` 来进行正则表达式匹配。这两个关键字是等价的，功能相同。

### 语法

```sql
SELECT column_name
FROM table_name
WHERE column_name REGEXP 'pattern';
```

- `column_name`：要进行正则匹配的列。
- `pattern`：正则表达式的模式。

### 示例

1. **匹配包含 "abc" 的记录：**

```sql
SELECT * FROM users
WHERE name REGEXP 'abc';
```

2. **匹配以字母 "a" 开头的记录：**

```sql
SELECT * FROM users
WHERE name REGEXP '^a';
```

3. **匹配包含数字的记录：**

```sql
SELECT * FROM products
WHERE description REGEXP '[0-9]';
```

4. **匹配以数字开头，后面跟有字母的记录：**

```sql
SELECT * FROM codes
WHERE code REGEXP '^[0-9]+[a-zA-Z]+';
```

---

## 3. REGEXP 与 LIKE 的区别

- **`LIKE`** 用于简单的模式匹配，使用 `%` 和 `_` 作为通配符来匹配字符串。
    - `%` 匹配零个或多个字符。
    - `_` 匹配一个字符。

- **`REGEXP`** 允许使用更复杂的模式，支持正则表达式的各种特性，具有更强的匹配能力。

### 示例对比

1. **LIKE：**

```sql
SELECT * FROM users
WHERE name LIKE 'a%';
```
- 匹配以 `a` 开头的记录。

2. **REGEXP：**

```sql
SELECT * FROM users
WHERE name REGEXP '^a';
```
- 同样匹配以 `a` 开头的记录，但 `REGEXP` 允许更复杂的正则匹配。

---

## 4. REGEXP 匹配选项

MySQL 中的正则表达式默认是 **不区分大小写** 的。如果你想要区分大小写，可以使用 `BINARY` 关键字。

### 示例：区分大小写的匹配

```sql
SELECT * FROM users
WHERE BINARY name REGEXP 'abc';
```

- 该查询仅匹配包含小写字母 `abc` 的记录，而不匹配 `ABC`。

---

## 5. 正则表达式函数

MySQL 提供了一些与正则表达式相关的内置函数，常见的有：

### 5.1 `REGEXP_LIKE`

用于检查某个字符串是否匹配正则表达式模式。

```sql
SELECT REGEXP_LIKE('abc', '^a');
-- 返回 1（表示匹配）
```

### 5.2 `REGEXP_INSTR`

用于返回正则表达式首次匹配到的位置。

```sql
SELECT REGEXP_INSTR('abcdef', 'c');
-- 返回 3（'c' 是从第 3 个位置开始的）
```

### 5.3 `REGEXP_REPLACE`

用于替换匹配正则表达式的部分。

```sql
SELECT REGEXP_REPLACE('123abc456', '[0-9]', '*');
-- 返回 ***abc***
```

### 5.4 `REGEXP_SUBSTR`

用于返回正则表达式匹配到的子字符串。

```sql
SELECT REGEXP_SUBSTR('abcdef', 'b');
-- 返回 b
```

---
