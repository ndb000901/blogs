# 常用寄存器

AMD CPU 的寄存器基本遵循 x86-64（AMD64）架构的设计，与 Intel 的 x86-64 寄存器体系大致相同。主要包括以下几类寄存器：  

---

## **1. 通用寄存器（General-Purpose Registers, GPRs）**
用于整数运算、数据存储、地址计算等。x86-64 提供 16 个 64 位通用寄存器：
| 64 位 | 32 位 | 16 位 | 8 位 (高) | 8 位 (低) | 说明 |
|-------|-------|-------|----------|----------|------|
| RAX   | EAX   | AX    | AH       | AL       | 累加寄存器，常用于返回值 |
| RBX   | EBX   | BX    | BH       | BL       | 基址寄存器 |
| RCX   | ECX   | CX    | CH       | CL       | 计数寄存器（如循环） |
| RDX   | EDX   | DX    | DH       | DL       | 数据寄存器（如 I/O 操作） |
| RSI   | ESI   | SI    |          | SIL      | 源索引寄存器 |
| RDI   | EDI   | DI    |          | DIL      | 目标索引寄存器 |
| RBP   | EBP   | BP    |          | BPL      | 基址指针寄存器（栈帧指针） |
| RSP   | ESP   | SP    |          | SPL      | 栈指针寄存器 |
| R8    | R8D   | R8W   |          | R8B      | 额外寄存器 |
| R9    | R9D   | R9W   |          | R9B      | 额外寄存器 |
| R10   | R10D  | R10W  |          | R10B     | 额外寄存器 |
| R11   | R11D  | R11W  |          | R11B     | 额外寄存器 |
| R12   | R12D  | R12W  |          | R12B     | 额外寄存器 |
| R13   | R13D  | R13W  |          | R13B     | 额外寄存器 |
| R14   | R14D  | R14W  |          | R14B     | 额外寄存器 |
| R15   | R15D  | R15W  |          | R15B     | 额外寄存器 |

**特点：**
- 64 位模式下，所有通用寄存器都可以存储 64 位数据。
- `RAX`、`RBX` 等是原有 x86（32 位）模式下的 `EAX`、`EBX` 的扩展。
- `R8-R15` 是 x86-64 新增的寄存器。
- `RSP` 主要用于栈操作，`RBP` 主要用于栈帧维护。

---

## **2. 指令指针寄存器**
| 64 位 | 32 位 | 说明 |
|-------|-------|------|
| RIP   | EIP   | 指令指针寄存器，存储当前执行指令的地址 |

**特点：**
- 64 位模式下，使用 `RIP`，不再支持 `IP`（16 位模式）和 `EIP`（32 位模式）。
- 在 x86-64 中，`RIP` 支持 **RIP-相对寻址**，使得代码更易重定位。

---

## **3. 标志寄存器（EFLAGS / RFLAGS）**
存储 CPU 运算的状态信息。64 位下使用 `RFLAGS`，其低 32 位仍然兼容 `EFLAGS`。常见的标志位：
| 位 | 标志 | 说明 |
|----|------|------|
| 0  | CF   | 进位标志（Carry Flag） |
| 2  | PF   | 奇偶标志（Parity Flag） |
| 4  | AF   | 辅助进位标志（Adjust Flag） |
| 6  | ZF   | 零标志（Zero Flag） |
| 7  | SF   | 符号标志（Sign Flag） |
| 8  | TF   | 陷阱标志（Trap Flag, 单步调试） |
| 9  | IF   | 中断使能标志（Interrupt Enable） |
| 10 | DF   | 方向标志（Direction Flag） |
| 11 | OF   | 溢出标志（Overflow Flag） |

---

## **4. 段寄存器（Segment Registers）**
主要用于内存分段管理，在 x86-64 下基本被废弃：
| 16 位 | 说明 |
|------|------|
| CS   | 代码段 |
| DS   | 数据段 |
| SS   | 栈段 |
| ES   | 附加数据段 |
| FS   | 额外数据段 |
| GS   | 额外数据段 |

**特点：**
- 在 x86-64 模式下，段寄存器几乎被忽略，只有 `FS` 和 `GS` 还用于 TLS（线程本地存储）。
- `FS` 和 `GS` 可用于存储 CPU 相关的特殊数据，如 Linux `fs:[0]` 可能存储 `thread_info` 结构。

---

## **5. 浮点与 SIMD 寄存器**
### **（1）x87 浮点寄存器**
用于老式的 x87 FPU（浮点运算单元），8 个 80 位寄存器：
| x87 FPU 寄存器 | 说明 |
|---------------|------|
| ST(0) ~ ST(7) | 80 位浮点寄存器，基于栈结构 |

**特点：**
- 现代处理器更推荐使用 SSE、AVX 代替 x87。

### **（2）SSE（Streaming SIMD Extensions）寄存器**
| 128 位 | 说明 |
|--------|------|
| XMM0 ~ XMM15 | SIMD 向量寄存器，支持 128 位浮点和整数运算 |

**特点：**
- SSE（SSE、SSE2、SSE3、SSSE3、SSE4.1、SSE4.2）是 Intel 和 AMD 都支持的 SIMD 指令集。
- 主要用于 128 位浮点和整数计算。

### **（3）AVX（Advanced Vector Extensions）寄存器**
| 256 位 | 128 位 | 说明 |
|--------|--------|------|
| YMM0 ~ YMM15 | XMM0 ~ XMM15 | 256 位扩展寄存器，支持 AVX |

**特点：**
- AVX 扩展了 XMM 128 位寄存器，使其支持 256 位运算。
- AVX2 增强了整数运算。
- AMD 的 Ryzen 及 EPYC CPU 也支持 AVX/AVX2。

### **（4）AVX-512**
| 512 位 | 说明 |
|--------|------|
| ZMM0 ~ ZMM31 | 512 位 SIMD 向量寄存器 |

**特点：**
- 目前 AMD 只在部分高端 CPU（如 Zen 4）支持 AVX-512。
- Intel 在 Xeon 和最新酷睿 CPU 支持 AVX-512。

---

## **6. 控制寄存器（Control Registers, CR）**
用于 CPU 保护模式控制：
| 寄存器 | 说明 |
|--------|------|
| CR0 | 控制 CPU 运行模式（如保护模式） |
| CR2 | 页面错误地址 |
| CR3 | 页表基地址（MMU 使用） |
| CR4 | 启用/禁用 CPU 特性 |
| CR8 | 仅 64 位模式，控制 APIC 优先级 |

---

## **7. 调试寄存器（Debug Registers, DR）**
用于硬件断点调试：
| 64 位 | 说明 |
|------|------|
| DR0 ~ DR3 | 断点寄存器 |
| DR6 | 断点状态寄存器 |
| DR7 | 断点控制寄存器 |

---

## **8. MSR（Model-Specific Registers）**
AMD CPU 还有许多特定的 MSR（如 `AMD-V` 相关的 `EFER` 寄存器）。

---

## **总结**
- **通用寄存器（GPRs）**：`RAX` ~ `R15`
- **指令指针**：`RIP`
- **标志寄存器**：`RFLAGS`
- **浮点/SIMD**：`XMM` / `YMM` / `ZMM`
- **控制寄存器**：`CR0` ~ `CR8`
- **调试寄存器**：`DR0` ~ `DR7`
- **AMD 专属寄存器**：如 `MSR`、`EFER`
